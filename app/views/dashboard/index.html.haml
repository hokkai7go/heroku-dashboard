#holder

:coffee
  $ ->
    dynos_legend = []
    dynos_data = []
    dynos_desc = []
    $.ajax "#{dynos_info_path(format: :json)}",
      type: 'GET'
      dataType: 'json'
      error: (jqXHR, textStatus, errorThrown) =>
        console.log textStatus
      success: (data, textStatus, jqXHR) =>
        $(data).each (key, message) =>
          dynos_legend.push message.name
          dynos_data.push message.dyno_data
          dynos_desc.push message.dyno_desc if message.dyno_data > 0
        r = Raphael("holder")
        pie = r.piechart(150, 200, 80, dynos_data, { legend: dynos_legend, legendpos: "west", href: dynos_desc})
        r.text(150, 80, "Dynos").attr font: "20px sans-serif"
        pie.hover (->
          @sector.stop()
          @sector.scale 1.1, 1.1, @cx, @cy
          if @label
            @label[0].stop()
            @label[0].attr r: 7.5
            @label[1].attr "font-weight": 800
        ), ->
          @sector.animate
            transform: "s1 1 " + @cx + " " + @cy
          , 500, "bounce"
          if @label
            @label[0].animate
              r: 5
            , 500, "bounce"
            @label[1].attr "font-weight": 400

- @app_groups.each do |group|
  .well.row
    .span2
    .span6
      %h1.text-center
        = link_to group.name, group_path(group.name)
        = content_tag(:i, '', class: 'icon-tags')
    .span3
      - if group.apps.present?
        %h4
          = "#{group.dynos_count}"
          %small dynos
        %h4
          = "#{number_to_currency(group.addon_cost)}"
          %small Addons
  - if group.apps.present?
    - group.apps.each do |app|
      .offset2
        %h3
          %label{:class => "label #{formatted_dynos(app.dynos_status_score)}"} Status
          = link_to app.name, heroku_app_path(app)
          %small= link_to app.web_url, app.web_url
        %dl.dl-horizontal
          %dt dynos
          %dd= app.dynos_summary
          %dt Addon Cost
          %dd= number_to_currency(app.addon_cost)
  - else
    %p.text-center No Apps.
    %hr/
